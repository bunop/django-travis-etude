services:
  - docker
branches:
  only:
    - master
    - devel
install:
  - docker-compose pull
  - docker-compose build
  - export BRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)
  - echo "TRAVIS_BRANCH=$TRAVIS_BRANCH, PR=$PR, BRANCH=$BRANCH"
script:
  - docker-compose run --rm uwsgi /root/wait-for-mysql.sh coverage run --source='.' -m py.test
after_script:
  - docker-compose run --rm uwsgi coveralls
env:
  global:
  - secure: SfxMd4O9a9D/fM30qRf5PCs2MvvYcsg56LRAR1m01RPofoqyuMjFUVR5pOsI2LMKHOcD9ULmw8gitQlCajAOczpU+o5Jq4WqtUD3RpyP011miNTtdUCC/CUiTKpL7ZoyctDIgcallmWM84Js9bwGPaaC3g3nMPAPvQttJOhUJDRBRi/ZhfiTXO1TWdwooL211+lYhW3uzXyqmC9iANwt3oPoiDH+6tz8aNmmDblHkDP6eI7g1v9OLoZkdWFLB9+MamAeUsI4+MB869g43K73QcFM9RG2Kj96sOkEG4LIaiK3lbY7ke2mHpkmxtBKGIoaxXLwJFu79bd9OdHZt0PeliUAw5OQWyi4U29JqEXQ5fwRJG6FTrtMkX2zdDGqRlFLGF8O2CfyE3c9Kg9C6v5/udPH3/XM9s/WgliVISbCFhZEEStS4oS8h62g4O6aSvWD5ZxS++oEV5GCR/elWRMnGTwtrZfWydJG4NrdVVP33Sif7tWKBrA84EvSGJJhWTKtxcWnK9Yh8JsORJed3SL3fU7l7ZjrtiLL8ZQ+f1gt9AhpQGVDh3n7Pcid6yCIBL00X2fXfsFWby6GQJjUkk/mhiHs2J9YVgl4DUzfiW0TZl/3ZDS2nfnQyEx6j2Kho9BjGZ/KR0hYBYf5U4a4iNsH4/1Hlyy9si2XxmRBC+QLob4=
  - secure: ChN/2T//0Rb48D6FoDYd0PxemFmkPzzucq7gvUCsccP9wiY5rPNEqmU8NplYgRJmD2Mu+nlSxHIruyXNKTewV5/+ennN8NXVFi7qGwHMLZzBRV0bbFUQ3E610HJi3fHs/YxUcy3U0TPR+7GCLq3FFdogWgpNIfkcvRBAbFOPVjAlnR95O8TqQhaVADKwOoz4n/gPHil+tNaVmVAujWaV+kif0l0oeHbW9HOruDNTcF5RYyD4cOV7y2KEVWhFe8Pi74YRnbChaL6lXCto8YAAF1zW4K3HNDhBeRiYHHXR0+IFQKQuCdEUwxeyQvC0Hvy+PShGwH7E8MHvlsylaIOrWZ6k+ub2WbGfVHnGebnMiTXod5rUxNtZHQEDmY0pofeDSXnRkiZWFNSJTk5Cq6hFVpAuUNUC3AD2V4keZbRMScybGY6L18CL588Z4oJ/dFFEJURTPEJt4VlmEikttLh0ogP+o9xtnAWwSYjPVYVpKcf0bI3/hU2LQ5BN4JVb6wF0PNh/tfXfWLoVzXHkYlDIdcQKyFPdSX+PQhRguPue0zbkVsqDdl0RuoO9Ad7aSzub7LQcT0dLu4FHi4wgweM7xBC3C+KIYD7eawSSEpic6UebGJalIH9rgAgwAB6mXHvlwGXkDbJ2dVJyExQiTmaSJNdClKXWkTG6tAZB6dYCpx8=
  - secure: GXj7rFU9zMb6HjFzCWKpmvlvIUyJWyw2pOF/88hCJY/Eq1i0Ue34sqGD1N6hfmW1XWxK524uBD0H0P6L5Ux8uMskq3iwBiebuTPV50iP6Gzmjn+ZtzAUQrrqZ8MrpXLGQ9ocS5NZxHG3N5ddc5GJHF990mLs1gbXo77991P/sU67OeULXYu5ftvxJIaxI5Qj6ZlQsckDovL0on35ngJCYc62CAEoUTMaPv9p7QZTPeOdHTQwhTFuP30369aWhmtcKEfCEc7+hPoRdaxUwZARDUnWnJla3EcPlP1M5NxfOLlHPO8XOIAAibzVTp0MMN5bFs3tq6YuZFZ2V0kVfemCYhcGRSSDaYsH6LGWiU3WtegQJhmM4/NSS/CcNussFe/491BgzY2L3E2WIH2uE4cGXZQ7SzBu1ZxJGAnhqV14qV/WcG4VsYgOJu4pn5Y8V56jAYsDo2SNBpPimnZ9hW2FdwCIHxxCK7g0jBf+RPwuxPc+iVdPt5UF0/SXEH7+JM5MPb/TE7UUBBuZ1T7jZbFcutIiN71mlM8+Q3JhycX944a8LfpoE2wbe+ZKPkEGhI51zSot/pfAahDVv8andTnNd/Q6q1Djk3uJUYASukwULw1k44Em6LGBdWPPAiB8iU7YF69wPyfKsPE5XAKYmL8TOfcvOP+0OhqQyU8WZnPgO5o=
  - secure: Fd23LCTt+pxam7sTHQbkMOdUH7uJakU0Te0F//+hz8TO05adr52dcgNNPrYqVluHubr/MftPaisY2m1DFCb0wDZUf2dQACM7fKqmpRu060vKF9zLedPPW2ObX61AWz1jg5dI8KBBvUVEVb70h94JQgP8Avom3zBJ3EkwwhJzBdWUhwWyg4lVtd1rTpzVcNHWTbIDrt6vzl85ZO7DPNyWmaPeVwZTIS0xKNY5h1ysl+HDWrLNACvZyKBbAWUmI4UqQHJaGSM9UlTjrqdmfKBQxJ6BWOvspymyw0AoPeHKVEPKF0euunwQ3Kkfx/J1SR6IQmyXEviMdEdiapTtOP6nPyHiTMcUOugwHU9yyizHx/5IKd/UhssoySwoPolqaPdWuGfgZjbyTRFm1glj8ERrll8qTcdQFdHRvJJrUBDmjUI1MnPsIidURy9pg3NmhgSq8ZSNgWtTYFhitBloVcQYcJhoET0mYy88brQkSdZ5GK/duUopuKmpW8DqaXZQjLld9yFvpr5UviYWPjknuIbKJlvvQF80EGuFgvyMC700qWo6Rd1VJIgwYwXtMhbovyZw/0EvnumIA6Dww8fcYOKF4TcHiaIPFzCvSd9s3GmN+qHgnlNins0Oi/ioQSGsmex84kmEIMPL4j9fLF1zKjU4J/UW2WgptM9J3Zfs/DQFbpQ=
  - secure: JSUeNAr9TpqaOVvYzAiiviZyLX6pHj/Axdlt0CDcAkUd1BMuC9lY0UDzKX1SW+Mbmp7TfIllxZ2Ss5yebQFrz3Bq2J9VZ7DFxGl+1FbqpGXCGeWBrLgdOT7paISwXwIIks3Cqo7t9j6CbeGbauuZxWQ1NusnE0RGERuueT7b/clfVCfyN0aaAPpzx5zB+IoX/W9gQi44ZQwvlh31wrz5qaiiSYcE6nf9nYB3GVVoyd3DT6zVXEuQjSgMXEPX3yDcanAcz5eXNP68VzbtUlMpNY1T77jXFzttu3Cx+y14dv1hH4frHcRKguPq1Mjv7E7Hv64COhdZ4EmphdeVhcrp5ME1E63e20J/tcPcbguzlFSINBbwsGVrxteHq/+pQTN31EDXYaozXZ4rD31jkB4y1gDDgmqeeKU/ElLV1HYVTemdvajYc/Rh7aZ4+fLkCp9wUhhgPk/gZGd0/xYi6QODAuiG3m2ITxfWxJrvvD4cVrZ3A0BEYC/K30wpXThNDrZ+3E7vZGwgVRa9j8kbEXi5W8xUUiKF/5i4TksI21mqfVc7uU5DAsJu1hp6M4LRABzb/C8HE9ZeYrcX/MphcaN7ZuT3YFiiUpE8TDzMq0Vs5+2mQBNLRu4rRzpDi3wdEajTfTtS+ittkLNKaMuNACph3WvcRPmmXHhdQwfcYudnJII=
  - secure: dr8yTImry4PWgSZJT/nYUP6tnjRZ60FKXAx/NUrQJmHD4FItZBu14drmN3ROiU0ueMB40MCSg4Cm0623fNpjjkMxflCR/ziOXYy7Owp5ZhaTyHRz/xQ8p3GphnzNnwN0DY26PNbaOaZKNwwQshh1KquN+BWTzTk6kCAssDSKLKOBYhQ47gd7PpzYKwRYM45BLzyvxxnsi114CmlCJchUgx6Pr2DPYkt9HTwKBexlxVLli7ZnK7O+mPnkFv2w4RUEFgE/+Q3H3R4Igp4T+bhU0QqqE5nRw3VbywT0R6EdVbVMzsAtvD+xSlz7RWulFPnwY3owbqPJN9PyhftXNj3tzN2J5oflc+1WjbC9HL52edoQxdPgO+2RV8uTO+wlfUaK7WGlXJEYImfs2sfRDHtF4QOMdp5QzQJXltoWt9XpnEthSUKDc3ZAqZzcIMgIMe/ypVGxLB/1iUPy35Dvz/9FH1Tx74E25wC2wW7jCU0/4/NQ3LHuhMoO9Pa7UzzZZM4l+c54k+/i37TU2cIN0b+BYjH45Kv3UF0SKYzazFVDPKLOLFnybWPcXu+Qdi8ge79o7kBITTmDtaoZ5Gj9psbQHJztqu/c2Jv4aFAEnvjTU+CCRo3RCyyct9GcmvUTVwR2WZJNcXuDmb5kPTHrAV41M0rRfWuGiDeKKQspElkqqZo=
